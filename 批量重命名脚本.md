# 批量重命名脚本

用法如下：    
<img src="https://github.com/y741269430/ATAC-seq/blob/main/img/rename.png" width="500" />     

```bash
vim rename_files.sh
```
写入以下内容
```bash
#!/bin/bash

# 检查参数数量
if [ "$#" -ne 2 ]; then
    echo "Usage: $0 <directory> <name.info>"
    exit 1
fi

directory=$1
info_file=$2

# 检查目录是否存在
if [ ! -d "$directory" ]; then
    echo "Directory '$directory' does not exist."
    exit 1
fi

# 检查 name.info 文件是否存在
if [ ! -f "$info_file" ]; then
    echo "File '$info_file' does not exist."
    exit 1
fi

# 存储前缀映射关系（关联数组）
declare -A prefix_map

# 读取 name.info 文件，构建映射关系
while IFS= read -r line || [[ -n "$line" ]]; do
    # 跳过空行和注释行（以#开头的行）
    if [[ -z "$line" || "$line" =~ ^\s*# ]]; then
        continue
    fi

    # 提取旧前缀和新前缀
    old_prefix=$(echo "$line" | awk '{print $1}')
    new_prefix=$(echo "$line" | awk '{print $2}')

    # 去除可能的空白字符
    old_prefix=$(echo "$old_prefix" | xargs)
    new_prefix=$(echo "$new_prefix" | xargs)

    # 检查是否为空
    if [[ -z "$old_prefix" || -z "$new_prefix" ]]; then
        echo "Skipping malformed line: '$line'"
        continue
    fi

    # 存储到关联数组
    prefix_map["$old_prefix"]="$new_prefix"
done < "$info_file"

# 如果没有有效的映射关系，退出
if [ ${#prefix_map[@]} -eq 0 ]; then
    echo "No valid prefix mappings found in '$info_file'."
    exit 1
fi

# 切换到目标目录
cd "$directory" || exit

# 遍历当前目录下的所有文件
for file in *; do
    # 跳过目录本身
    if [ -d "$file" ]; then
        continue
    fi

    renamed=false

    # 检查文件是否匹配某个旧前缀
    for old_prefix in "${!prefix_map[@]}"; do
        new_prefix="${prefix_map[$old_prefix]}"
        
        # 如果文件名以 old_prefix 开头，则替换
        if [[ "$file" == "$old_prefix"* ]]; then
            new_file="${file/$old_prefix/$new_prefix}"
            
            # 检查新文件名是否已存在
            if [ -e "$new_file" ]; then
                echo "Error: Target file '$new_file' already exists. Skipping '$file'."
                continue
            fi
            
            # 执行重命名操作
            mv -- "$file" "$new_file"
            if [ $? -eq 0 ]; then
                echo "Renamed: '$file' → '$new_file'"
            else
                echo "Failed to rename '$file'."
            fi
            renamed=true
            break  # 匹配到一个前缀即可，避免重复替换
        fi
    done

    # 如果没有匹配到任何前缀，跳过
    if ! $renamed; then
        echo "No matching prefix for '$file', skipping..."
    fi
done

```
用法：
```bash
bash rename_files.sh macs2 name.info
```
其中name.info如下：    
<img src="https://github.com/y741269430/ATAC-seq/blob/main/img/rename2.png" width="300" />     


